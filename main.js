(()=>{"use strict";var e={url:"https://nomoreparties.co/v1/wff-cohort-42",headers:{authorization:"e9f1a4a8-3394-4c77-b24a-f38f53566cda","Content-Type":"application/json"}};function t(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}var n=document.querySelector("#card-template").content;function r(e,t,r,o,c){var i=n.querySelector(".card").cloneNode(!0),a=i.querySelector(".card__image"),u=i.querySelector(".card__title"),l=i.querySelector(".card__delete-button"),s=i.querySelector(".card__like-button"),d=i.querySelector(".card__like-count"),p=i.querySelector(".card__delete-button");return i.dataset.cardId=e.id,a.src=e.link,a.alt=e.name,u.textContent=e.name,void 0!==e.likes&&e.likes.length>0&&(d.textContent=e.likes.length),void 0!==e.owner&&void 0!==e.owner.id&&t===e.owner.id||p.classList.add("card__delete-button-disible"),l.addEventListener("click",(function(){return r(e.id)})),s.addEventListener("click",(function(){return o(e.id,e.likes,s,d)})),a.addEventListener("click",(function(){return c(e.link,e.name)})),void 0!==e.likes&&e.likes.forEach((function(e){e._id===t&&s.classList.add("card__like-button_is-active")})),i}function o(n,r,o,c){var i;o.classList.contains("card__like-button_is-active")?function(n){return fetch("".concat(e.url,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then(t)}(n).then((function(e){o.classList.remove("card__like-button_is-active"),c.textContent=e.likes.length>0?e.likes.length:""})).catch((function(e){return console.error("Ошибка запроса удаления лайка карты ",e)})):(i=n,fetch("".concat(e.url,"/cards/likes/").concat(i),{method:"PUT",headers:e.headers}).then(t)).then((function(e){o.classList.add("card__like-button_is-active"),c.textContent=e.likes.length||0})).catch((function(e){return console.error("Ошибка запроса лайка карты ",e)}))}function c(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",a)}function i(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a)}function a(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&i(t)}}function u(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(n){n.setCustomValidity(""),l(e,n,t)})),s(n,r,t)}function l(e,t,n){var r=d(e,t);t.classList.remove(n.inputErrorClass),r.textContent="",r.classList.remove(n.errorClass)}function s(e,t,n){var r=e.some((function(e){return!e.validity.valid}));t.disabled=r,t.classList.toggle(n.inactiveButtonClass,r)}function d(e,t){return e.querySelector(".".concat(t.id,"-error"))}var p=null,_=function(){return p},f=document.querySelector(".places__list"),m=document.querySelector(".profile__edit-button"),y=document.querySelector(".popup_type_edit"),v=document.querySelector(".profile__add-button"),h=document.querySelector(".profile__image"),S=document.querySelector(".popup_type_new-card"),k=document.querySelector(".popup_type_image"),q=document.querySelector(".popup_confirmation_delete"),b=document.querySelector(".popup_profile_image"),E=y.querySelector(".popup__form"),L=b.querySelector(".popup__form"),C=S.querySelector(".popup__form"),g=q.querySelector(".popup__form"),x=y.querySelector(".popup__input_type_name"),w=document.querySelector(".profile__title"),A=y.querySelector(".popup__input_type_description"),T=document.querySelector(".profile__description"),D=S.querySelector(".popup__input_type_card-name"),B=S.querySelector(".popup__input_type_url"),I=b.querySelector(".popup__input_type_url"),P=document.querySelector(".profile__image"),N=document.querySelector(".popup_type_image"),O=N.querySelector(".popup__image"),j=N.querySelector(".popup__caption"),J=E.querySelector(".popup__button"),M=S.querySelector(".popup__button"),V=S.querySelector(".popup__button"),H={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function z(e,t){O.src=e,O.alt=t,j.textContent=t,c(N)}function U(e){q.dataset.cardId=e,c(q)}function F(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";e.disabled=t,e.textContent=t?r:n}m.addEventListener("click",(function(){x.value=w.textContent,A.value=T.textContent,u(E,H),c(y)})),v.addEventListener("click",(function(){C.reset(),u(C,H),c(S)})),h.addEventListener("click",(function(){L.reset(),u(L,H),c(b)})),E.addEventListener("submit",(function(n){var r;n.preventDefault(),F(J,!0),(r={title:x.value,description:A.value},fetch("".concat(e.url,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:r.title,about:r.description})}).then(t)).then((function(e){w.textContent=e.name,T.textContent=e.about,i(y)})).catch((function(e){console.error("Ошибка при сохранение профиля:",e)})).finally((function(){F(J,!1)}))})),C.addEventListener("submit",(function(n){n.preventDefault(),F(V,!0);var c,a=_();(c={name:D.value,link:B.value},fetch("".concat(e.url,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:c.name,link:c.link})}).then(t)).then((function(e){f.prepend(r({id:e._id,name:e.name,link:e.link,likes:e.likes,owner:{id:a._id}},a._id,U,o,(function(e,t){return z(e,t)}))),C.reset(),u(C,H),i(S)})).catch((function(e){console.error("Ошибка при сохранение карточки:",e)})).finally((function(){F(V,!1)}))})),g.addEventListener("submit",(function(n){n.preventDefault();var r=q.dataset.cardId;(function(n){return fetch("".concat(e.url,"/cards/").concat(n),{method:"DELETE",headers:e.headers}).then(t)})(r).then((function(){var e=document.querySelector('.card[data-card-id="'.concat(r,'"]'));e&&e.remove(),i(q)})).catch((function(e){console.error("Ошибка при удаление карточки:",e)}))})),L.addEventListener("submit",(function(n){var r;n.preventDefault(),F(M,!0),(r=I.value,fetch("".concat(e.url,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:r})}).then(t)).then((function(e){P.style.backgroundImage="url(".concat(e.avatar,")"),i(b)})).catch((function(e){console.error("Ошибка при обновление аватара:",e)})).finally((function(){F(M,!1)}))})),[y,S,k,q,b].forEach((function(e){e.addEventListener("click",(function(t){(t.target===e||t.target.classList.contains("popup__close"))&&i(e)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage||"Недопустимый формат строки"):t.setCustomValidity(""),t.validity.valid?l(e,t,n):function(e,t,n,r){var o=d(e,t);t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(t,o,e),s(n,r,e)}))}))}))}(H),fetch("".concat(e.url,"/users/me"),{headers:e.headers}).then(t).then((function(n){return p=n,w.textContent=n.name,T.textContent=n.about,P.style.backgroundImage="url(".concat(n.avatar,")"),fetch("".concat(e.url,"/cards"),{headers:e.headers}).then(t).catch((function(e){return console.error("Ошибка загрузки профиля ",e)}))})).then((function(e){e.map((function(e){return{id:e._id,name:e.name,link:e.link,likes:e.likes,owner:{id:e.owner._id,name:e.owner.name,about:e.owner.about,avatar:e.owner.avatar}}})).forEach((function(e){f.append(r(e,_()._id,U,o,(function(e,t){return z(e,t)})))})).catch((function(e){console.error("Ошибка загрузки карточек:",e)}))})).catch((function(e){return console.error("Ошибка загрузки профиля ",e)}))})();