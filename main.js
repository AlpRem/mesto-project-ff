(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",r)}function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r)}function n(t){var n=t.target.closest(".card").querySelector(".card__title"),r=document.querySelector(".popup_type_image .popup__image"),o=document.querySelector(".popup_type_image .popup__caption");r.src=t.target.src,r.alt=t.target.alt,o.textContent=n.textContent,e(document.querySelector(".popup_type_image"))}function r(e){if("Escape"===e.key){var n=document.querySelector(".popup_is-opened");n&&t(n)}}var o={url:"https://nomoreparties.co/v1/wff-cohort-42",headers:{authorization:"e9f1a4a8-3394-4c77-b24a-f38f53566cda","Content-Type":"application/json"}},c=null,u=function(){return c},i=document.querySelector("#card-template").content;function a(e,t,n,r){var o=i.querySelector(".card").cloneNode(!0),c=o.querySelector(".card__image"),a=o.querySelector(".card__title"),l=o.querySelector(".card__delete-button"),s=o.querySelector(".card__like-button"),d=o.querySelector(".card__like-count"),p=o.querySelector(".card__delete-button"),_=u();return o.dataset.cardId=e.id,c.src=e.link,c.alt=e.name,a.textContent=e.name,void 0!==e.likes&&e.likes.length>0&&(d.textContent=e.likes.length),void 0!==e.owner&&void 0!==e.owner.id&&_._id===e.owner.id||p.classList.add("card__delete-button-disible"),l.addEventListener("click",t),s.addEventListener("click",n),c.addEventListener("click",r),void 0!==e.likes&&e.likes.forEach((function(e){e.id===_.id&&s.classList.add("card__like-button_is-active")})),o}function l(t,n){n.dataset.cardId=t,e(n)}function s(e,t,n){var r,c=n.target.classList.toggle("card__like-button_is-active"),u=n.currentTarget.closest(".card").querySelector(".card__like-count");c?(r=e,fetch("".concat(o.url,"/cards/likes/").concat(r),{method:"PUT",headers:o.headers}).then((function(e){return e.json()})).catch((function(e){return console.error("Ошибка запроса лайка карты ",e)}))).then((function(e){u.textContent=e.likes.length||0})):function(e){return fetch("".concat(o.url,"/cards/likes/").concat(e),{method:"DELETE",headers:o.headers}).then((function(e){return e.json()})).catch((function(e){return console.error("Ошибка запроса удаления лайка карты ",e)}))}(e).then((function(e){void 0!==t||0===e.likes.length?u.textContent="":u.textContent=e.likes.length||0}))}function d(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(n){n.setCustomValidity(""),p(e,n,t)})),_(n,r,t)}function p(e,t,n){var r=f(e,t);t.classList.remove(n.inputErrorClass),r.textContent="",r.classList.remove(n.errorClass)}function _(e,t,n){var r=e.some((function(e){return!e.validity.valid}));t.disabled=r,t.classList.toggle(n.inactiveButtonClass,r)}function f(e,t){return e.querySelector(".".concat(t.id,"-error"))}var m=document.querySelector(".places__list"),y=document.querySelector(".profile__edit-button"),h=document.querySelector(".popup_type_edit"),v=document.querySelector(".profile__add-button"),S=document.querySelector(".profile__image"),q=document.querySelector(".popup_type_new-card"),k=document.querySelector(".popup_type_image"),C=document.querySelector(".popup_confirmation_delete"),b=document.querySelector(".popup_profile_image"),g=h.querySelector(".popup__form"),E=b.querySelector(".popup__form"),L=q.querySelector(".popup__form"),x=C.querySelector(".popup__form"),w=h.querySelector(".popup__input_type_name"),j=document.querySelector(".profile__title"),A=h.querySelector(".popup__input_type_description"),T=document.querySelector(".profile__description"),D=q.querySelector(".popup__input_type_card-name"),B=q.querySelector(".popup__input_type_url"),I=b.querySelector(".popup__input_type_url"),N=document.querySelector(".profile__image"),O={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};y.addEventListener("click",(function(){w.value=j.textContent,A.value=T.textContent,d(g,O),e(h)})),v.addEventListener("click",(function(){L.reset(),d(L,O),e(q)})),S.addEventListener("click",(function(){E.reset(),d(E,O),e(b)})),g.addEventListener("submit",(function(e){e.preventDefault(),j.textContent=w.value,T.textContent=A.value;var n,r=q.querySelector(".popup__button");r.textContent="Сохранение...",(n={title:w.value,description:A.value},fetch("".concat(o.url,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:n.title,about:n.description})}).then((function(e){return e.json()})).catch((function(e){return console.error("Ошибка запроса редактирования профиля ",e)}))).then((function(e){j.textContent=e.name,T.textContent=e.about})).catch((function(e){console.error("Ошибка при сохранение профиля:",e)})).finally((function(){r.textContent="Сохранение",t(h)}))})),L.addEventListener("submit",(function(e){e.preventDefault();var r=q.querySelector(".popup__button");r.textContent="Сохранение...";var c,i=u();(c={name:D.value,link:B.value},fetch("".concat(o.url,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify({name:c.name,link:c.link})}).then((function(e){return e.json()})).catch((function(e){return console.error("Ошибка запроса добавления карты ",e)}))).then((function(e){m.prepend(a({id:e._id,name:e.name,link:e.link,likes:e.likes,owner:{id:i._id}},(function(t){return l(e._id,C)}),(function(t){return s(e._id,e.likes,t)}),n))})).catch((function(e){console.error("Ошибка при сохранение карточки:",e)})).finally((function(){r.textContent="Сохранение",L.reset(),d(L,O),t(q)}))})),x.addEventListener("submit",(function(e){e.preventDefault();var n=C.dataset.cardId;(function(e){return fetch("".concat(o.url,"/cards/").concat(e),{method:"DELETE",headers:o.headers}).then((function(e){return e.json()})).catch((function(e){return console.error("Ошибка запроса удаления карты ",e)}))})(n).then((function(){var e=document.querySelector('.card[data-card-id="'.concat(n,'"]'));e&&e.remove()})).catch((function(e){console.error("Ошибка при удаление карточки:",e)})).finally((function(){t(C)}))})),E.addEventListener("submit",(function(e){e.preventDefault();var n,r=q.querySelector(".popup__button");r.textContent="Сохранение...",(n=I.value,fetch("".concat(o.url,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:n})}).then((function(e){return e.json()})).catch((function(e){return console.error("Ошибка запроса редактирования профиля ",e)}))).then((function(e){N.style.backgroundImage="url(".concat(e.avatar,")")})).catch((function(e){console.error("Ошибка при обновление аватара:",e)})).finally((function(){r.textContent="Сохранение",t(b)}))})),[h,q,k,C,b].forEach((function(e){e.addEventListener("click",(function(n){(n.target===e||n.target.classList.contains("popup__close"))&&t(e)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage||"Недопустимый формат строки"):t.setCustomValidity(""),t.validity.valid?p(e,t,n):function(e,t,n,r){var o=f(e,t);t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(t,o,e),_(n,r,e)}))}))}))}(O),fetch("".concat(o.url,"/users/me"),{headers:o.headers}).then((function(e){return e.json()})).catch((function(e){return console.error("Ошибка загрузки профиля ",e)})).then((function(e){return c=e,j.textContent=e.name,T.textContent=e.about,N.style.backgroundImage="url(".concat(e.avatar,")"),fetch("".concat(o.url,"/cards"),{headers:o.headers}).then((function(e){return e.json()})).catch((function(e){return console.error("Ошибка загрузки карточек ",e)}))})).then((function(e){e.map((function(e){return{id:e._id,name:e.name,link:e.link,likes:e.likes,owner:{id:e.owner._id,name:e.owner.name,about:e.owner.about,avatar:e.owner.avatar}}})).forEach((function(e){m.append(a(e,(function(t){return l(e.id,C)}),(function(t){return s(e.id,e.likes,t)}),n))}))}))})();